<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
</head>
<div th:fragment="content">
    <div class="container">
        <h1 style="text-align:center; font-family: 'Times New Roman', Times, serif;">Quản Lý Bài Viết</h1>
        
        <div style="text-align:right; margin-right:45px; margin-bottom:10px;">
            <button id="btnAddArticle" type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addArticleModal">
                Thêm Bài Viết
            </button>
        </div>
        
        <table class="table table-striped table-sm" id="articleTable">
            <thead>
                <tr style="text-align:center;">
                    <th style="width: 5%;">STT</th>
                    <th style="width: 8%;">Mã Bài Viết</th>
                    <th style="width: 15%;">Tiêu Đề</th>
                    <th style="width: 20%;">Nội Dung</th>
                    <th style="width: 8%;">Hình Ảnh</th>
                    <th style="width: 10%;">Ngày Đăng</th>
                    <th style="width: 12%;">Nhân Viên</th>
                    <th style="width: 10%;">Thao Tác</th>
                </tr>
            </thead>
            <tbody>
                <tr style="text-align:center;" th:each="article, stt : ${articles}">
                    <td th:text="${stt.index + 1}">1</td> 
                    <td th:text="${article.maBaiViet} ?: 'N/A'">BV001</td> 
                    <td style="word-break: break-word;" th:text="${article.tieuDe} ?: 'N/A'">Tiêu đề</td> 
                    <td style="word-break: break-word; max-width: 200px; overflow: hidden; text-overflow: ellipsis;" th:text="${article.noiDung} ?: 'N/A'">Nội dung</td> 
                    <td>
                        <img th:src="${article.hinhAnh}" th:if="${article.hinhAnh}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 4px;" alt="Hinh anh" />
                        <span th:unless="${article.hinhAnh}" style="color: #999;">N/A</span>
                    </td>
                    <td th:text="${#dates.format(article.ngayDang, 'dd/MM/yyyy')} ?: 'N/A'">01/10/2025</td>
                    <td>
                        <span th:if="${employees != null}">
                            <th:block th:each="emp : ${employees}">
                                <span th:if="${emp.id == article.nhanVienId}" th:text="${emp.tenNV}">Tên nhân viên</span>
                            </th:block>
                        </span>
                        <span th:unless="${employees != null}" th:text="${article.nhanVienId}">ID</span>
                    </td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-info" 
                                    th:data-article-id="${article.id}"
                                    data-bs-toggle="modal" 
                                    data-bs-target="#editArticleModal">
                                <i class="fas fa-edit"></i>
                            </button> 
                            <button class="btn btn-danger" 
                                    th:data-article-id="${article.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                <tr th:if="${articles == null or articles.isEmpty()}">
                    <td colspan="8" class="text-center text-danger">Không có bài viết nào!</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Modal Sửa thông tin bài viết -->
    <div class="modal fade" id="editArticleModal" tabindex="-1" aria-labelledby="editArticleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editArticleModalLabel">Sửa Thông Tin Bài Viết</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editArticleForm">
                        <input type="hidden" id="edit_id">
                        <div class="mb-3">
                            <label for="edit_maBaiViet" class="form-label">Mã Bài Viết</label>
                            <input type="text" class="form-control" id="edit_maBaiViet" readonly>
                        </div>
                        <div class="mb-3">
                            <label for="edit_tieuDe" class="form-label">Tiêu Đề *</label>
                            <input type="text" class="form-control" id="edit_tieuDe" required>
                        </div>
                        <div class="mb-3">
                            <label for="edit_noiDung" class="form-label">Nội Dung *</label>
                            <textarea class="form-control" id="edit_noiDung" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="edit_ngayDang" class="form-label">Ngày Đăng *</label>
                            <input type="date" class="form-control" id="edit_ngayDang" required>
                        </div>
                        <div class="mb-3">
                            <label for="edit_nhanVienId" class="form-label">Nhân Viên *</label>
                            <select class="form-select" id="edit_nhanVienId" required>
                                <option value="">-- Chọn nhân viên --</option>
                                <option th:each="emp : ${employees}" 
                                        th:value="${emp.id}" 
                                        th:text="${emp.tenNV + ' (' + emp.maNV + ')'}">
                                    Nhân viên
                                </option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="edit_hinhAnh" class="form-label">Chọn Hình Ảnh</label>
                            <input type="file" class="form-control" id="edit_hinhAnh" accept="image/*">
                            <small class="text-muted">Để trống nếu không muốn thay đổi hình ảnh</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                    <button type="button" class="btn btn-primary" id="saveUpdateArticleBtn">Lưu Thay Đổi</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Thêm Bài Viết -->
    <div class="modal fade" id="addArticleModal" tabindex="-1" aria-labelledby="addArticleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addArticleModalLabel">Thêm Bài Viết Mới</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addArticleForm" class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Mã bài viết *</label>
                            <input type="text" class="form-control" id="add_maBaiViet" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Tiêu đề *</label>
                            <input type="text" class="form-control" id="add_tieuDe" required>
                        </div>
                        <div class="col-12">
                            <label class="form-label">Nội dung *</label>
                            <textarea class="form-control" id="add_noiDung" rows="3" required></textarea>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Ngày đăng *</label>
                            <input type="date" class="form-control" id="add_ngayDang" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Nhân viên *</label>
                            <select class="form-select" id="add_nhanVienId" required>
                                <option value="">-- Chọn nhân viên --</option>
                                <option th:each="emp : ${employees}" 
                                        th:value="${emp.id}" 
                                        th:text="${emp.tenNV + ' (' + emp.maNV + ')'}">
                                    Nhân viên
                                </option>
                            </select>
                        </div>
                        <div class="col-12">
                            <label for="add_hinhAnh" class="form-label">Chọn Hình Ảnh</label>
                            <input type="file" class="form-control" id="add_hinhAnh" accept="image/*" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                    <button type="button" class="btn btn-primary" id="saveNewArticleBtn">Lưu bài viết</button>
                </div>
            </div>
        </div>
    </div>

    <script th:src="@{/js/admin/article.js}"></script>
</div>
</html>